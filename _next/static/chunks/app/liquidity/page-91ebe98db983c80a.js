(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{3812:(e,t,a)=>{Promise.resolve().then(a.bind(a,4719))},4719:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var l=a(5155),r=a(2115),n=a(6911);let s=e=>{let{isOpen:t,onClose:a,children:r,className:n}=e;return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-sm ".concat(n),children:[(0,l.jsx)("button",{onClick:a,className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800",children:"✕"}),r]})}):null};var i=a(5631),c=a(8808),o=a(2316),d=a(2276),u=a(4570),g=a(9659),m=a(9092),h=a(5016);let x=()=>{let{walletConnected:e,walletAddress:t,connectWallet:a}=(0,m.v)(),x="0xE314913f34Ddb810142Acca1Acd3C96603e42468",f="0x5BAAA2054Bba4A1FEAf52aFb8502B14c61A8Bed9",b="0x46caFcED9C1E16F05b474774144f325A16d9B26E",[w,y]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[p,N]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[A,E]=(0,r.useState)(""),[S,q]=(0,r.useState)(!1),[F,L]=(0,r.useState)(!1),[B,P]=(0,r.useState)("0"),V=(e,t)=>{let a=e===b?u.HV:e===f?g.HV:d.HV;return new i.NZ(e,a,t)},O=async e=>{let t=window.ethereum,a=new c.k(t),l=V(e,await a.getSigner());try{return await l.decimals()}catch(t){throw console.error("Error fetching decimals for ".concat(e,":"),t),Error("Failed to get decimals for token ".concat(e))}},R=async(e,t,a)=>{console.log("begin to apporve");let l=window.ethereum,r=new c.k(l),n=V(t,await r.getSigner());try{let l=await n.allowance(e,a);if(console.log("".concat(t," 授权额度: ").concat(l.toString())),BigInt(l)===BigInt(0)){console.log("".concat(t," 授权不足，开始授权..."));let e=await n.approve(a,h.V);console.log("授权交易已提交，等待确认...",e.hash),await e.wait(),console.log("".concat(t," 授权成功"))}}catch(e){throw console.error("Error ensuring approval for ".concat(t,":"),e),Error("Failed to ensure approval for ".concat(t))}},H=async()=>{if(!e||!t){alert("Please connect your wallet first.");return}try{q(!0);let e=await O(f),a=await O(b);console.log("usdcDecimals, erc20Decimals ",e,a);let l=window.ethereum,r=new c.k(l),n=await r.getSigner(),s=V(f,n),u=V(b,n),g=await s.balanceOf(t),m=await u.balanceOf(t),h=o.XS(p,e),w=o.XS(k,a);if(g<h||m<w){alert("Insufficient token balance to add liquidity."),q(!1);return}console.log("开始授权"),await R(t,f,x),await R(t,b,x),console.log("授权完成");let v=new i.NZ(x,d.HV,n),j=await v.addLiquidity(h,w);await j.wait(),q(!1),alert("Liquidity added successfully!"),N(""),C(""),y(!1)}catch(e){console.error("Error adding liquidity:",e),q(!1),alert("Failed to add liquidity. Please try again.")}},I=async()=>{if(!e||!t){alert("Please connect your wallet first.");return}try{L(!0);let e=window.ethereum,a=new c.k(e),l=await a.getSigner(),r=new i.NZ(x,d.HV,l),n=await r.balanceOf(t),s=o.XS(A,18);if(BigInt(n)<BigInt(s)){alert("Insufficient LP token balance."),L(!1);return}let u=await r.removeLiquidity(s);await u.wait(),alert("Liquidity removed successfully!"),L(!1),E(""),j(!1)}catch(e){console.error("Error removing liquidity:",e),L(!1),alert("Failed to remove liquidity. Please try again.")}},_=async()=>{if(e)try{let e=window.ethereum,t=new c.k(e),a=await t.getSigner(),l=new i.NZ(x,d.HV,a),[r,n]=await l.getReserves(),s=o.Js(r,6),u=o.Js(n,18),g=parseFloat(s)*parseFloat(u);P(g.toString())}catch(e){console.error("Error fetching reserves:",e)}};return(0,r.useEffect)(()=>{e&&_()},[e]),(0,l.jsx)("div",{className:"min-h-screen bg-blue-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6 w-full max-w-md",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-800 text-center mb-6",children:"Manage Liquidity"}),e?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Pool Reserves"}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,l.jsx)("span",{className:"text-gray-700",children:"k Value:"}),(0,l.jsx)("span",{className:"text-purple-700 font-semibold",children:B})]}),(0,l.jsx)(n.A,{onClick:_,className:"mt-4 bg-indigo-500 hover:bg-indigo-600 w-full text-white",children:"Refresh Reserves"})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(n.A,{onClick:()=>y(!0),className:"w-full bg-green-500 hover:bg-green-600",children:"Add Liquidity"}),(0,l.jsx)(n.A,{onClick:()=>j(!0),className:"w-full bg-red-500 hover:bg-red-600",children:"Remove Liquidity"})]})]}):(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:"Wallet not connected. Please connect your wallet to continue."}),(0,l.jsx)(n.A,{onClick:a,className:"w-full bg-blue-500 hover:bg-blue-600 text-white",children:"Connect Wallet"})]}),(0,l.jsxs)(s,{isOpen:w,onClose:()=>y(!1),children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"Add Liquidity"}),(0,l.jsxs)("form",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"Mock USDC Amount"}),(0,l.jsx)("input",{type:"number",className:"w-full p-2 mt-2 border rounded-lg focus:outline-none focus:ring focus:ring-green-500",placeholder:"Enter amount",value:p,onChange:e=>N(e.target.value)}),(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-600 mt-4",children:"Mock ERC20 Amount"}),(0,l.jsx)("input",{type:"number",className:"w-full p-2 mt-2 border rounded-lg focus:outline-none focus:ring focus:ring-green-500",placeholder:"Enter amount",value:k,onChange:e=>C(e.target.value)}),(0,l.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,l.jsx)(n.A,{onClick:()=>y(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800",disabled:S,children:"Cancel"}),(0,l.jsx)(n.A,{onClick:H,className:"bg-green-500 hover:bg-green-600",disabled:S,children:"Confirm"})]})]})]}),(0,l.jsxs)(s,{isOpen:v,onClose:()=>j(!1),children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"Remove Liquidity"}),(0,l.jsxs)("form",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"Liquidity Amount"}),(0,l.jsx)("input",{type:"number",className:"w-full p-2 mt-2 border rounded-lg focus:outline-none focus:ring focus:ring-red-500",placeholder:"Enter amount",value:A,onChange:e=>E(e.target.value)}),(0,l.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,l.jsx)(n.A,{onClick:()=>j(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800",disabled:F,children:"Cancel"}),(0,l.jsx)(n.A,{onClick:I,className:"bg-red-500 hover:bg-red-600",disabled:F,children:"Confirm"})]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[733,911,441,517,358],()=>t(3812)),_N_E=e.O()}]);